<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <!-- JQUERY   -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- BOOTSTRAP -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="/css/RdvPatient/rdvPatient.css" />
  </head>
  <body>
    <div class="alert alert1" id="alertId" role="alert">
      Votre action a été effectuée avec succès !
    </div>
    <div class="alert alert2" id="alertId2" role="alert">
      Veuillez réessayer ultérieurement .
    </div>
    <form action="/users/medecin/makeCas17" method="POST">
      <input type="hidden" name="patient17" value="<%=data.idpatient %>" />
      <input type="hidden" name="date17" value="<%=data.date_rdv %>" />
      <input type="radio" name="statesel" value="reschedule" /><label>
        Reprogrammer le rendez-vous</label
      ><br />
      <div id="hiddendiv">
        <input
          id="rdv_date_update"
          name="rdv_date_update"
          type="datetime-local"
        /><br />
        <table id="list" name="list" class="list">
          <input id="adddate" class="adddate" type="button" value="Ajouter" />
          <thead>
            <tr>
              <th>Date</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <input type="text" id="dates" name="dates" class="dates" />
      </div>
      <input type="radio" name="statesel" value="refuse" /><label>
        Refuser le rendez-vous </label
      ><br />
      <input type="radio" name="statesel" value="mark" /><label>
        marquer comme fait </label
      ><br />

      <div class="cas17done">
        <input type="checkbox" /> <label>Ajouter une explication</label>
        <div class="hiddencheck">
          <textarea name="cas17notreq"></textarea>
        </div>
      </div>
      <div class="cas3cancel">
        <textarea name="cas17req" required></textarea><br />
      </div>
      <input type="submit" value="Valider" onclick="addCas0()" />
    </form>
    <script>
      function addCas0() {
        var radioValue = $("input[name='statesel']:checked").val();
        var explicationdone = $("#cas3explication1").val();
        var explicationcancel = $("#cas3explication2").val();
        var patient = $("input[name='patient']").val();
        var date = $("input[name='date']").val();

        var dates = document.getElementById("dates");
        var myTab = document.getElementById("list");

        for (i = 0; i < myTab.rows.length; i++) {
          var objCells = myTab.rows.item(i).cells;

          for (var j = 0; j < 1; j++) {
            dates.value = dates.value + "/" + objCells.item(j).innerHTML;
          }
        }
      }

      const formEl = document.querySelector(".adddate");
      const tbodyEl = document.querySelector("tbody");
      const tableEl = document.querySelector("table");

      function onAddRow(e) {
        e.preventDefault();
        const addeddate = document.getElementById("rdv_date_update").value;
        tbodyEl.innerHTML += `
    <tr>
      <td>${addeddate}</td>
      <td><button class="deleteBtn">Supprimer</button></td>
    </tr>
    `;
      }

      function onDeleteRow(e) {
        if (!e.target.classList.contains("deleteBtn")) {
          return;
        }

        const btn = e.target;
        btn.closest("tr").remove();
      }
      var myTab = document.getElementById("list");

      formEl.addEventListener("click", onAddRow);
      tableEl.addEventListener("click", onDeleteRow);
    </script>
    <script src="/js/RdvRequests.js"></script>
  </body>
</html>
