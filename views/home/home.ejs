<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accueil</title>
    <link rel="stylesheet" href="/css/admin/main.css" />
    <link rel="stylesheet" href="/css/home/main.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">


    <!-- JQUERY   -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> 
</head>
<style>
    .notif-title {
        font-size:13px;
        color : #01559c;
    }
    .notif-desc {
        font-size:11px;
        
    }
    .notif-date {
        font-size:11px;
        color : #01559c;
    }
    .txt{
    background-color:red;
    font-size:xx-small;
    position: absolute;
    padding:2px;
    top: 1px;
    left: 1px;
    height: 20px;
    width: 20px;
    border-radius: 50%;
}
.toastStyle {
    font-size:12px;
    width: 400px;
}
    button {
      border: none;
    }
    
         .vertical-nav {
          box-shadow: 5px 0 5px -5px grey;

    
    height : 1000px;
           margin-top: 0px;
      min-width: 17rem;
      width: 17rem;
      position: fixed;
      top: 0;      
      left: 0;
  
      transition: all 0.4s;
    }
    .page-content {
      margin-left: 17rem;
      height: 100%;
      transition: all 0.4s;
    } 
    input, button, submit { border:none; } 

    #sidebar.active {
      margin-left: -17rem;
    }
    
    #content.active {
      width: 100%;
      margin: 0;
    }
    .dropbtn {

  color: white;
  padding: 0px;
  font-size: 16px;
  border: none;
  background-color: inherit;
}

/* The container <div> - needed to position the dropdown content */
.dropdown {
  position: relative;

}

/* Dropdown Content (Hidden by Default) */
.dropdown-content {
  display: none;
  position: absolute;
  right: 13px;
  background-color: #f1f1f1;
  width: 290px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 2;
}

/* Links inside the dropdown */
.dropdown-content a {
  color: black;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
  font-size: 10px;
}
.show {display:block;}

/* Change color of dropdown links on hover */
.dropdown-content a:hover {background-color: #ddd;}
/* Show the dropdown menu on hover */
/* Change the background color of the dropdown button when the dropdown content is shown */
.dropdown:hover .dropbtn {}
.dropbtn2 {

color: white;
padding: 0px;
font-size: 16px;
border: none;
background-color: inherit;
}

/* The container <div> - needed to position the dropdown content */
.dropdown2 {
position:relative;

}

/* Dropdown Content (Hidden by Default) */
.dropdown-content2 {
display: none;

position:absolute;

background-color: #f1f1f1;
width: 290px;
box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);

}

/* Links inside the dropdown */
.dropdown-content2 a {
color: black;
padding: 12px 16px;
text-decoration: none;
display: block;
font-size: 10px;
}
.show {display:block;}

/* Change color of dropdown links on hover */
.dropdown-content2 a:hover {background-color: #ddd;}

/* Show the dropdown menu on hover */


/* Change the background color of the dropdown button when the dropdown content is shown */
.dropdown2:hover .dropbtn {}
  
    .btn-nav {
    
      display: flex; 
      align-self: flex-start;
      
    }
    
    .spa {
      margin-left: 17em;
    }
    .text-uppercase {
      letter-spacing: 0.1em;
    }
    .text-gray {
      color: #aaa;
    }
    .nav-link{
        text-transform: capitalize;
    }
    .nav-link:hover{
        background:#f3f2f2;
    }
    .text-primary{
        color:#7579e7 !important;
    }
    @media (max-width: 768px) {
      #sidebar {
        margin-left: -17rem;
      }
      #sidebar.active {
        margin-left: 0;
        margin-top: 20px;
        height: 100px;
      }
      #content {
        width: 100%;
        margin: 0;
      }
      #content.active {
        margin-left: 17rem;
        width: calc(100% - 17rem);
      }
    }
    
    .row-h {
      
      padding: 20px 30px;
      display: flex;
      flex-direction: row;
    }
    
    </style>
 
<body>
    <div class="nav navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid mx-2">
            <img src="/assets/drawer.svg" id="sidebarCollapse2" height="29px" width="29px" style="margin-left: 10px;" />
            <img src="/assets/logo.png" height="50px" width="100px" style="margin-left: 20px;margin-top:10px"/>
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarNavDropdown"
            aria-controls="navbarNavDropdown"
            aria-expanded="false"
            aria-label="Toggle navigation">
            <span class="navbar-toggler-icon">BM</span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNavDropdown">
            <ul class="navbar-nav ms-auto">
                <div class="dropdown">
                    <button class="dropbtn"  onclick="myFunction()" class="dropbtn">
                        <img src="/assets/notif.svg" height="30px" width="30px" style="margin-right: 20px;margin-top:5px"/>
                        <div class="txt" id="txt"><%= notifssee %></div>
                    </button>
                    <div  id="myDropdown" class="dropdown-content">
              
                        <% notifs.forEach(function(notif){ %>
                            <a>
                                <div class="notif-title">
                                    <%= notif.title_notif %> <br>
                                </div>  
                                <div class="notif-desc">
                                    <%= notif.description_notif %> <br>
                                </div>  
                                <div class="notif-date">
                              
                                    <%=       moment(notif.date_notif).format('YYYY-MM-DD hh:mm')  %>
                                </div>  
                            
                            </a>
                  
                            <% }); %> 
                    
                       
                        
                    </div>
                  </div>
              <li class="nav-item dropdown">
                <div class="square"><%= user.Lastname.substring(0,2) %></div>
                <div class="name"><%= user.Firstname %></div>
                <ul
                  class="dropdown-menu"
                  aria-labelledby="navbarDropdownMenuLink"
                >
                  <li><a class="dropdown-item">Se déconnecter</a></li>
                </ul>
              </li>

            </ul>


          </div>
          
        </div>
      </div>
      <div class="principal">
<div class="column1">
 <div class="container-image">
  <div class="big-title">
    Bienvenue sur Hygieia
  </div> 
  <ul>
      <li>
        <a href="/users/medecin/list" style="all: unset">
          - Faire des examens médicaux 
        </a>
      </li>
      <li>
        <a href="/users/medecin/list" style="all: unset">
          
          - Consulter les dossiers médicaux
        
        </a>
  
      </li>
      <li>

        <a href="/users/medecin/list" style="all: unset">
          - consulter les statistique des maladies
        </a>
      </li>
      <li>
        <a href="/users/medecin/list" style="all: unset">
          
          - Programmer des rendez-vous
        
        </a>
      </li>
  </ul>
</div>
<div class="container-list">
    <div class="row" id="row">
        <div class="patient">
Patients
        </div>
        <div class="tous">
          <a href="/users/medecin/list"> Voir tous</a> 
                    </div>
                  
    </div>
    <% rdvs.forEach(function(rdv){ %>
        <div class="co">
            <img class="img-etu" src="<%- rdv.Picture  %>" height="47px" width="10px">   
        </img>
            <div class="nom">
                <%- rdv.p_Firstname  %>
                <%- rdv.p_Lastname  %>

            </div>
            <div class="date">
                <%-  moment(rdv.date_rdv).format('YYYY-MM-DD hh:mm')   %>
            
                    </div>
                    <div class="email">
                        <%- rdv.Email  %>
                            </div>
                             
        <div class="role">
            <%- rdv.Role  %>
                </div>
                  <div class="dropdown2">
                      <img class="dropbtn2"   onclick="myFunction2('<%=rdv.date_rdv%>')" src="/assets/icon-t.svg" height="15px" width="105px" />
                                 <div id='<%=rdv.date_rdv%>' class="dropdown-content2">
                      <a href="/users/medecin/medicalfileUpdate/?id=<%=rdv.IdPatient%>">Modifier dossier médical</a>
                      <a href="#">Programer un rendez-vous</a>
                      <a href="/users/medecin/infoExam/?id=<%= rdv.IdPatient%>">Faire un examen médical</a>
                    </div>
              
                 
                </div>
        </div>
      <% }); %>
   
 
  
    
    
    
    
  

</div>
</div>
<div class="column2">
   
    <div class="container-rdv">
        <div class="calendar"> 
            <div class="calendar-header">
                <span class="month-picker" id="month-picker">Février</span>
                <div class="year-picker">
                    <span class="year-change" id="prev-year">
                        <pre><img src="/assets/previous.svg" /></pre>
                    </span>
                    <span id="year">2021</span>
                    <span class="year-change" id="next-year">
                        <pre><img src="/assets/next.svg" /></pre>
                    </span>
                </div>
            </div>
            <div class="calendar-body">
                <div class="calendar-week-day">
                    <div>Dim</div>
                    <div>Lun</div>
                    <div>Mar</div>
                    <div>Mer</div>
                    <div>Jeu</div>
                    <div>Ven</div>
                    <div>Sam</div>
                </div>
                <div class="calendar-days"></div>
            </div>
            <div class="month-list"></div>
            <div class="first">
                <%= rdv_today %> Rendez-vous aujourdhui 
            </div>
            <div class="container-stat">
                <%= rdv_demande %>       Demande de rendez vous
            </div>
            <div class="container-stat">
                <%= rdv_reprogrammation %>      Demande de reprogrammation
    
            </div>
            <div class="container-go">
               <a href="/users/medecin/RDV">Calendrier des rendez-vous</a> 
    
            </div>
        </div>
     
    
    
    
    

    
    
    
    
    
    
    
    
    
    </div>
   
  
   
  
</div>
<div class="vertical-nav active" id="sidebar" style="position: absolute;height: 100%; background-color:white">
    <div class="py-4 px-0" style="background-color: white">
      <div class="media d-flex align-items-center" style="display: flex; align-self: start; margin: 0px 40px;">  
        <img src="/assets/drawer.svg" id="sidebarCollapse" height="29px" width="29px" />
        <img src="/assets/logo.png" height="60px" width="120px" style="margin-left: 40px"/>
      </div>
    </div>

    <ul class="nav" style="display: flex;align-items: start;background-color: white;  box-shadow: 0px 0px 0px 0px #888;">
        <li class="nav-item" style="margin-left: 30px;background-color: white;margin-top: 60px;">
            <a href="/users/medecin/home" class="nav-link text-dark" style="font-size: 18px; height: 50px; background-color:white; ">
                <img  src="/assets/icondrawer/home1.svg" height="20px" width="20px" />
    
                <i class="fa fa-sign-out-alt fa-lg" style="margin-right: 15px; background-color: white;"></i>
                 Accueil
                  </a>
          </li>
          <li class="nav-item" style="margin-left: 30px; margin-top:15px;">
            <a href="/users/medecin/list" class="nav-link text-dark" style="font-size: 18px; height: 50px;">
                <img  src="/assets/iconsDrawer/patient.svg" height="20px" width="20px" />
    
                <i class="fa fa-calendar-alt fa-lg" style="margin-right: 15px;"></i> </i>
                     Patients
                  </a>
          </li>
      <li class="nav-item" style="margin-left: 30px;margin-top: 15px;">
        <a href="#" class="nav-link text-dark" style="font-size: 18px; height: 50px;">
            <img  src="/assets/iconsDrawer/rdv.svg" height="20px" width="20px" />

            <i class="fa fa-calendar-alt fa-lg" style="margin-right: 15px;"></i> </i>
                 Rendez-vous
              </a>
      </li>
      <li class="nav-item" style="margin-left: 30px;margin-top: 15px;">
        <a href="/users/medecin/infoStat" class="nav-link text-dark" style="font-size: 18px; height: 50px;">
            <img  src="/assets/iconsDrawer/stat.svg" height="20px" width="20px" />

            <i class="fa fa-user fa-lg" style="margin-right: 15px;"></i></i>     
                    Statistiques
              </a>
      </li>
      <li class="nav-item" style="margin-left: 30px;margin-top: 15px;">
        <a href="/users/medecin/profile" class="nav-link text-dark" style="font-size: 18px; height: 50px;">
            <img  src="/assets/iconsDrawer/profile.svg" height="20px" width="20px" />

            <i class="fa fa-user fa-lg" style="margin-right: 15px;"></i></i>     
                   Profile
              </a>
      </li>
       <li class="nav-item" style="margin-left: 30px;margin-top: 15px;">
          <div class="con" style="width: 220px; height:1px;background-color: grey;"></div>
          </li>
  
        <li class="nav-item" style="margin-left: 30px;margin-top: 15px;">
            <a  href="/users/logout" class="nav-link text-dark" style="font-size: 18px; height: 50px;" >
                <img  src="/assets/iconsDrawer/disconnect.svg" height="20px" width="20px" />
    
                <i class="fa fa-sign-out-alt fa-lg" style="margin-right: 15px;"></i>
                 Déconnexion
                  </a>
          </li>
    </ul>  

  </div>
</body>
<script>
    $(function() { 
  $('#sidebarCollapse').on('click', function() {
    
    
    $('#sidebar, #content').toggleClass('active');
    $('.alert').addClass("show");
   


});
    })

</script>
<script>
    let calendar = document.querySelector('.calendar')

const month_names = ['Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Decembre']

isLeapYear = (year) => {
    return (year % 4 === 0 && year % 100 !== 0 && year % 400 !== 0) || (year % 100 === 0 && year % 400 ===0)
}

getFebDays = (year) => {
    return isLeapYear(year) ? 29 : 28
}

generateCalendar = (month, year) => {

    let calendar_days = calendar.querySelector('.calendar-days')
    let calendar_header_year = calendar.querySelector('#year')

    let days_of_month = [31, getFebDays(year), 31, 30, 31, 30, 31, 31, 30, 31, 30, 31]

    calendar_days.innerHTML = ''

    let currDate = new Date()
    if (!month) month = currDate.getMonth()
    if (!year) year = currDate.getFullYear()

    let curr_month = `${month_names[month]}`
    month_picker.innerHTML = curr_month
    calendar_header_year.innerHTML = year

    // get first day of month
    
    let first_day = new Date(year, month, 1)
    for (let i = 0; i <= days_of_month[month] + first_day.getDay() - 1; i++) {
        let day = document.createElement('div')
        if (i >= first_day.getDay()) {
            day.classList.add('calendar-day-hover')
            day.innerHTML = i - first_day.getDay() + 1
            day.innerHTML += `<span></span>
                            <span></span>
                            <span></span>
                            <span></span>`
            if (i - first_day.getDay() + 1 === currDate.getDate() && year === currDate.getFullYear() && month === currDate.getMonth()) {
                day.classList.add('curr-date')
            }
        }
        calendar_days.appendChild(day)
    }
}

let month_list = calendar.querySelector('.month-list')

month_names.forEach((e, index) => {
    let month = document.createElement('div')
    month.innerHTML = `<div data-month="${index}">${e}</div>`
    month.querySelector('div').onclick = () => {
        month_list.classList.remove('show')
        curr_month.value = index
        generateCalendar(index, curr_year.value)
    }
    month_list.appendChild(month)
})
let month_picker = calendar.querySelector('#month-picker')
month_picker.onclick = () => {
    month_list.classList.add('show')
}
let currDate = new Date()
let curr_month = {value: currDate.getMonth()}
let curr_year = {value: currDate.getFullYear()}
generateCalendar(curr_month.value, curr_year.value)
document.querySelector('#prev-year').onclick = () => {
    --curr_year.value
    generateCalendar(curr_month.value, curr_year.value)
}
document.querySelector('#next-year').onclick = () => {
    ++curr_year.value
    generateCalendar(curr_month.value, curr_year.value)
}
</script>
<script>
    function myFunction() {
  document.getElementById("myDropdown").classList.toggle("show");
}

// Close the dropdown menu if the user clicks outside of it
window.onclick = function(event) {
  

    
    $.ajax({
        method: 'POST',
        url: '/users/medecin/seenotifs',
        success: function (result) { 
         
    if(result.msg == 'success') {
        txt.innerHTML = 0 ; 
    }  
    
        }});

  if (!event.target.matches('.dropbtn')) {
    var dropdowns = document.getElementsByClassName("dropdown-content");
    var i;
    for (i = 0; i < dropdowns.length; i++) {
      var openDropdown = dropdowns[i];
      if (openDropdown.classList.contains('show')) {
        openDropdown.classList.remove('show');
      }
    }
  }
}
</script>
<script src="/socket.io/socket.io.js"></script>
<script>
 const socket = io();   
    socket.on('new-notification', (resp) => {
      let iduser = '<%-iduser%>'; 

     if(iduser == resp.iduser) {
       const txt  = document.getElementById("txt"); 
     txt.innerHTML = parseFloat(txt.innerHTML)+1;
   var myDropdown = document.getElementById("myDropdown");  
   const div = document.createElement('a');

 var date  = new Date(); 
 date.getFullYear() + date.getMonth() + date.getDay() 
 
div.innerHTML = `
<div class="notif-title">
  ${ resp.title }
                      </div>  
                      <div class="notif-desc">
                        ${ resp.description }
                      </div> 
                      <div class="notif-date">

                        ${ resp.date }
                  
                </div>  

`;  
myDropdown .insertBefore(div, myDropdown.firstChild);


                            
                     
                
                  
            
      Toastify({
  text:resp.title+ "\n" + resp.description,
  duration: 1000000,
  destination: "facebook.com",
  newWindow: true,
  close: true,
  className	: "toastStyle" ,
  gravity: "bottom", // `top` or `bottom`
  position: "left", // `left`, `center` or `right`
  backgroundColor: "linear-gradient(to right, #09c6f9, #045de9)",
  stopOnFocus: true, // Prevents dismissing of toast on hover
  onClick: function(){


  } // Callback after click
}).showToast();
     } 
      
    });
</script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js">


</script>
<script>
  $(function() { 

  $('#sidebarCollapse2').on('click', function() {
    
    $('#sidebar, #content').toggleClass('active');
    $('.alert').addClass("show");
    
  });
});
</script>

<script>
  function myFunction2(date) {
    console.log('here');
  document.getElementById(date).classList.toggle("show");
}

// Close the dropdown menu if the user clicks outside of it
window.onclick = function(event) {
  if (!event.target.matches('.dropbtn2')) {
    var dropdowns = document.getElementsByClassName("dropdown-content2");
    var i;
    for (i = 0; i < dropdowns.length; i++) {
      var openDropdown = dropdowns[i];
      if (openDropdown.classList.contains('show')) {
        openDropdown.classList.remove('show');
      }
    }
  }
}
</script>

</html>