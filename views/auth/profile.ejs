<!DOCTYPE html>
<html lang="en">

<head>
  <title>Profile</title>
  <meta charset="UTF-8" />
  <link
  rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-2/css/all.min.css"
/>
  <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- =====  ICONS ===== -->
  <link rel="stylesheet" href="https://cdn-uicons.flaticon.com/uicons-regular-rounded/css/uicons-regular-rounded.css" />
  <!-- CSS -->
    <!-- BOOTSTRAP -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <!-- JQUERY   -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link rel="stylesheet" href="/css/auth/profile.css" />
</head>
<style>
  .btn-primary{
background-color: #01559C;
border: none;
font-size: 15px;
}
.btn-danger {
  background-color: #dc3545;
    border-color: #dc3545;
  font-size: 15px;
border: none;
}
  select {
    padding-right: 20px;
    height: 150%;
    width: 20%;
    font-size: 15px;
    padding-left: 10px;
    background-color: #f6f2f2;
    border-radius: 5px;
    border: solid 1px rgb(194, 188, 188);
  }
  
   .data2 input {
    
    height: 100%;
    width: 200px;
    font-size: 15px;
    padding-left: 10px;
    padding-right: 10px;
    background-color: #f6f2f2;
    border-radius: 5px;
    border: solid 1px rgb(194, 188, 188);
    margin-bottom: 10px;

  }
  button {
  border: none;
}

     .vertical-nav {
  

       margin-top: 115px;
  min-width: 17rem;
  width: 17rem;
  height: 90vh;
  position: fixed;
  top: 0;
  left: 0;
  
   box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.1); 
  transition: all 0.4s;
}
.page-content {
  width: calc(100% - 17rem);
  margin-left: 17rem;
  transition: all 0.4s;
} 

#sidebar.active {
  margin-left: -17rem;
}

#content.active {
  width: 100%;
  margin: 0;
}
.fa-bars {
  background-color: #F5F5F5;

}
.separator {
  margin: 3rem 0;
  border-bottom: 1px dashed #fff;
}
.fa {
    color:#01559C;
}
.btn-nav {

  display: flex; 
  align-self: flex-start;
  
}

.spa {
  margin-left: 17em;
}
.text-uppercase {
  letter-spacing: 0.1em;
}
.text-gray {
  color: #aaa;
}
.nav-link{
    text-transform: capitalize;
}
.nav-link:hover{
    background:#f3f2f2;
}
.text-primary{
    color:#7579e7 !important;
}
@media (max-width: 768px) {
  #sidebar {
    margin-left: -17rem;
  }
  #sidebar.active {
    margin-left: 0;
    margin-top: 20px;
  }
  #content {
    width: 100%;
    margin: 0;
  }
  #content.active {
    margin-left: 17rem;
    width: calc(100% - 17rem);
  }
}

.row-h {
  
  padding: 20px 30px;
  display: flex;
  height: 100px;
  flex-direction: row;
  align-items: start;
  justify-content: space-between;
}
</style>
<style>
    .name {
            margin-right: 40px;
            margin-left: 10px;
            margin-top: 5px;
          }
  .square {
  background-color: #01559c;
  height: 40px;
  width: 44px;
  border-radius: 10px;
  color: white;
  text-align: center;
  font-weight: 500;
  display: flex;
  align-items: center;
  justify-content: center;
}
  .notif-title {
      font-size:13px;
      color : #01559c;
  }
  .notif-desc {
      font-size:11px;
      
  }
  .notif-date {
      font-size:11px;
      color : #01559c;
  }
  .txt{
  background-color:red;
  font-size:xx-small;
  position: absolute;
  padding:2px;
  top: 1px;
  left: 1px;
  height: 20px;
  width: 20px;
  border-radius: 50%;
}
.toastStyle {
  font-size:12px;
  width: 400px;
}
  button {
    border: none;
  }
  
       .vertical-nav {
        box-shadow: 5px 0 5px -5px grey;

  
  height : 1000px;
         margin-top: 0px;
    min-width: 17rem;
    width: 17rem;
    position: fixed;
    top: 0;      
    left: 0;

    transition: all 0.4s;
  }
  .page-content {
    margin-left: 17rem;
    height: 100%;
    transition: all 0.4s;
  } 
  input, button, submit { border:none; } 

  #sidebar.active {
    margin-left: -17rem;
  }
  
  #content.active {
    width: 100%;
    margin: 0;
  }
  .dropbtn {

color: white;
padding: 0px;
font-size: 16px;
border: none;
background-color: inherit;
}

/* The container <div> - needed to position the dropdown content */
.dropdown {
position: relative;

}

/* Dropdown Content (Hidden by Default) */
.dropdown-content {
display: none;
position: absolute;
right: 13px;
background-color: #f1f1f1;
width: 290px;
box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
z-index: 2;
}

/* Links inside the dropdown */
.dropdown-content a {
color: black;
padding: 12px 16px;
text-decoration: none;
display: block;
font-size: 10px;
}
.show {display:block;}

/* Change color of dropdown links on hover */
.dropdown-content a:hover {background-color: #ddd;}
/* Show the dropdown menu on hover */
/* Change the background color of the dropdown button when the dropdown content is shown */
.dropdown:hover .dropbtn {}
.dropbtn2 {

color: white;
padding: 0px;
font-size: 16px;
border: none;
background-color: inherit;
}

/* The container <div> - needed to position the dropdown content */
.dropdown2 {
position:relative;

}

/* Dropdown Content (Hidden by Default) */
.dropdown-content2 {
display: none;

position:absolute;

background-color: #f1f1f1;
width: 290px;
box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);

}

/* Links inside the dropdown */
.dropdown-content2 a {
color: black;
padding: 12px 16px;
text-decoration: none;
display: block;
font-size: 10px;
}
.show {display:block;}

/* Change color of dropdown links on hover */
.dropdown-content2 a:hover {background-color: #ddd;}

/* Show the dropdown menu on hover */


/* Change the background color of the dropdown button when the dropdown content is shown */
.dropdown2:hover .dropbtn {}

  .btn-nav {
  
    display: flex; 
    align-self: flex-start;
    
  }
  
  .spa {
    margin-left: 17em;
  }
  .text-uppercase {
    letter-spacing: 0.1em;
  }
  .text-gray {
    color: #aaa;
  }
  .nav-link{
      text-transform: capitalize;
  }
  .nav-link:hover{
      background:#f3f2f2;
  }
  .text-primary{
      color:#7579e7 !important;
  }
  @media (max-width: 768px) {
    #sidebar {
      margin-left: -17rem;
    }
    #sidebar.active {
      margin-left: 0;
      margin-top: 20px;
      height: 100px;
    }
    #content {
      width: 100%;
      margin: 0;
    }
    #content.active {
      margin-left: 17rem;
      width: calc(100% - 17rem);
    }
  }
  
  .row-h {
    padding: 20px 30px;
    display: flex;
    flex-direction: row;
  }
  
  </style>

<body>

  <div class="nav navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid mx-2">
        <img src="/assets/drawer.svg" id="sidebarCollapse2" height="29px" width="29px" style="margin-left: 10px;" />
        <img src="/assets/logo.png" height="50px" width="100px" style="margin-left: 20px;margin-top:10px"/>
      <button
        class="navbar-toggler"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#navbarNavDropdown"
        aria-controls="navbarNavDropdown"
        aria-expanded="false"
        aria-label="Toggle navigation">
        <span class="navbar-toggler-icon">BM</span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNavDropdown">
        <ul class="navbar-nav ms-auto">
            <div class="dropdown">
                <button class="dropbtn"  onclick="myFunction()" class="dropbtn">
                    <img src="/assets/notif.svg" height="30px" width="30px" style="margin-right: 20px;margin-top:5px"/>
                    <div class="txt" id="txt"><%= notifssee %></div>
                </button>
                <div  id="myDropdown" class="dropdown-content">
          
                    <% notifs.forEach(function(notif){ %>
                        <a>
                            <div class="notif-title">
                                <%= notif.title_notif %> <br>
                            </div>  
                            <div class="notif-desc">
                                <%= notif.description_notif %> <br>
                            </div>  
                            <div class="notif-date">
                          
                                <%=       moment(notif.date_notif).format('YYYY-MM-DD hh:mm')  %>
                            </div>  
                        
                        </a>
              
                        <% }); %> 
                
             
                    
                </div>
              </div>
          <li class="nav-item dropdown" style="display:flex;flex-direction: row;">
            <div class="square"><%= user.Lastname.substring(0,2) %></div>
            <div class="name"><%= user.Firstname %></div>
            <ul
              class="dropdown-menu"
              aria-labelledby="navbarDropdownMenuLink"
            >
              <li><a class="dropdown-item">Se déconnecter</a></li>
            </ul>
          </li>
        </ul>

      </div>
      
    </div>
  </div>
<div class="rest">

</div>

</div>
      <div class="big-card">
        <div class="title2">Vos informations personnelles</div>
        <hr style="width:100%;text-align:left;margin-left:0px;" ></hr>
        <div class="column-info">
          <div class="info-per">
            <div class="job" style="font-weight: bold;"><%= infoPer.Firstname %> <%= infoPer.Lastname %></div>  
            <div class="job"><%= infoPer.Role %></div>
            <div class="date"><%= String(infoPer.Birthday).substring(0,16) %></div>
            <script>
              document.getElementById('get_file').onclick = function() {
               document.getElementById('ifile').click();
               console.log(document.getElementById('ifile').files)
              }

            </script>
          </div>   
        </div>
        <div class="title3">Votre emploie du temps</div>
        <hr style="width:100%;text-align:left;margin-left:0" ></hr>
        <div class="column-info3">
          <div class="insert-date">
            <div class="date">  
              <div class="date">
                <select  id="jour"  required>
                  <option value="" selected disabled hidden>Jour</option>
    
                  <% for (var i = 0; i < days.length; i++) { %>
                    <option value="<%= days[i] %>"><%= days[i] %></option>
                  <% } %>
                   
                 
                </select>
                <select  id="heured"  required>
          <option value="" selected disabled hidden>heure début</option>
    
        <% for (var i = 0; i < heure.length; i++) { %>
          <option value="<%= heure[i] %>"><%= heure[i] %></option>
        <% } %>
                 
                </select>
                <select  id="heuref"  required>
                  <option value="" selected disabled hidden>Heure fin</option>
                  <% for (var i = 0; i < heure.length; i++) { %>
                    <option value="<%= heure[i] %>"><%= heure[i] %></option>
                  <% } %>
                           
              
                </select> 
    
            </div>       

          </div>
          <button type="button" id="btn-add-date" class="btn33 btn-primary">Ajouter</button>

     
       </div>
        <table id="myTable" class="table table-hover" style="width:90%">
          <thead>
            <tr>
              <th scope="col">#</th>
              <th scope="col">Jour</th>
              <th scope="col">Début</th>
              <th scope="col">Fin</th>
              <th scope="col-md-3">Action</th>
            </tr>
          </thead>
        
            
                <% for (var i = 0; i < workTime.length; i++) { %>
                  <tr>
                  <td><%= i+1 %></td>
                  <td><%= workTime[i].work_date %></td>
                  <td><%= workTime[i].starttime %></td>
                  <td><%= workTime[i].endtime %></td>    
                  <td>
                      <button type="button" class="btn
                      
                      btn-danger" id="btn-delete-date" value="<%= workTime[i].work_date %>">Supprimer</button>
                    </td>
                  </tr>
                
                  
                <% } %>
              
                       
       
        
      
        
          </tbody>
        </table>
    

      </div>
      <div class="title2">Modifier votre mot de passe</div>
      <hr style="width:100%;text-align:left;margin-left:0" ></hr>
      <div class="column-info2">

        <div style="display: flex;flex-direction: column;">
          <div class="row">
            <div class="title"> Votre mot de passe</div>
            <div class="data">
              <input type="text" id="password1" required />
              </div>
          </div>
          <div class="row">
            <div class="title">Nouveau mot de passe</div>
            <div class="data">
              <input type="text" id="password2" required  />
              </div>
          </div>
          <div class="row">
            <div class="row2">
              <div class="title">Confirmer mot de passe</div>
              <div class="data">
                <input type="text" id="password3" required />
                </div>
            </div>
           
              <button type="button" id="update-password" class="btn2 btn-primary" id="btn-intoxication">Modifier mot de passe</button>


          </div>
        </div>
      </div>
    
</body>
<div class="vertical-nav active" id="sidebar" style="position: absolute;height: 100%; background-color:white">
  <div class="py-4 px-0" style="background-color: white">
    <div class="media d-flex align-items-center" style="display: flex; align-self: start; margin: 0px 40px;">  
      <img src="/assets/drawer.svg" id="sidebarCollapse" height="29px" width="29px" />
      <img src="/assets/logo.png" height="60px" width="120px" style="margin-left: 40px"/>
    </div>
  </div>

  <ul class="nav" style="display: flex;align-items: start;background-color: white;  box-shadow: 0px 0px 0px 0px #888;">
      <li class="nav-item" style="margin-left: 30px;background-color: white;margin-top: 60px;">
          <a href="/users/medecin/home" class="nav-link text-dark" style="font-size: 18px; height: 50px; background-color:white; ">
              <img  src="/assets/icondrawer/home.svg" height="20px" width="20px" />
  
              <i class="" style="margin-right: 15px; background-color: white;"></i>
               Accueil
                </a>
        </li>
        <li class="nav-item" style="margin-left: 30px; margin-top:15px;">
          <a href="/users/medecin/list" class="nav-link text-dark" style="font-size: 18px; height: 50px;">
              <img  src="/assets/iconsDrawer/patient.svg" height="20px" width="20px" />
  
              <i class="fa" style="margin-right: 15px;"></i> </i>
                   Patients
                </a>
        </li>
    <li class="nav-item" style="margin-left: 30px;margin-top: 15px;">
      <a href="#" class="nav-link text-dark" style="font-size: 18px; height: 50px;">
          <img  src="/assets/iconsDrawer/rdv.svg" height="20px" width="20px" />
          <i class="fa" style="margin-right: 15px;"></i> </i>
               Rendez-vous
            </a>
    </li>
    <li class="nav-item" style="margin-left: 30px;margin-top: 15px;">
      <a href="/users/medecin/infoStat" class="nav-link text-dark" style="font-size: 18px; height: 50px;">
          <img  src="/assets/iconsDrawer/stat.svg" height="20px" width="20px" />

          <i class="fa" style="margin-right: 15px;"></i></i>     
                  Statistiques
            </a>
    </li>
    <li class="nav-item" style="margin-left: 30px;margin-top: 15px;">
      <a href="/users/medecin/profile" class="nav-link text-dark" style="font-size: 18px; height: 50px;">
          <img  src="/assets/icondrawer/profil1.svg" height="20px" width="20px" />

          <i class="fa" style="margin-right: 15px;"></i></i>     
                 Profile
            </a>
    </li>
     <li class="nav-item" style="margin-left: 30px;margin-top: 15px;">
        <div class="con" style="width: 220px; height:1px;background-color: grey;"></div>
        </li>

      <li class="nav-item" style="margin-left: 30px;margin-top: 15px;">
          <a  href="/users/logout" class="nav-link text-dark" style="font-size: 18px; height: 50px;" >
              <img  src="/assets/iconsDrawer/disconnect.svg" height="20px" width="20px" />
  
              <i class="fa" style="margin-right: 15px;"></i>
               Déconnexion
                </a>
        </li>
  </ul>  

</div>
<div id="alert" class="alert hide">

  <span class="msg" id="msg">Opération effectué avec succées</span>
  <div class="close-btn">
     <span id="icon-msg" class="fas fa-check"></span>
  </div>
</div>
<script>
  const msg = document.getElementById("msg");
const icon = document.getElementById("icon-msg"); 
const btn3 = document.getElementById("update-password"); 
btn3.onclick = function() {
  const password1 = document.getElementById("password1"); 
  const password2 = document.getElementById("password2");
  const password3 = document.getElementById("password3");  
  if(password1.value.length < 6) {
    showMsg("vous devez entrer un mot de passe correct"); 
    return ; 
  }
  if(password2.value.length < 6) {
    showMsg("vous devez entrer votre nouveau mot de passe"); 
    return;
  }
  if(password2.value != password3.value){
    showMsg("vous devez confirmer votre nouveau mot de passe"); 
    return; 
  }

  $.ajax({
      method: 'POST',
        url: '/users/medecin/changePassword',
        data:    {
          'password1': password1.value,
          'password2': password2.value,
          'password3': password3.value,
        },
        success: function (result) { 
          showMsg(result.msg,!result.err);
          setTimeout(function(){
            window.location.reload();
                },5000);
     
         

        } 
    }); 
}
  function showMsg(str,err) {
    if(err == true) {
        icon.className = "fas fa-check"
    }else {
        icon.className = "fas fa-exclamation" 
    }
    msg.innerHTML = str ;
                $('.alert').addClass("show");
                $('.alert').removeClass("hide");
                $('.alert').addClass("showAlert");
                setTimeout(function(){
                  $('.alert').removeClass("show");
                  $('.alert').addClass("hide");
                },5000);

}
  var buttons = document.getElementsByTagName("button"); 
  //returns a nodelist
for (let i = 0; i < buttons.length; i++) {
  buttons[i].addEventListener("click", function() {
      
 
    if(buttons[i].id == 'btn-delete-date'){
      $.ajax({
      method: 'POST',
        url: '/users/medecin/deleteWork',
        data:    {
          'work_date' : buttons[i].value,
        },
        success: function (result) { 
          showMsg(result.msg,!result.err);
          setTimeout(function(){
            window.location.reload();
                },5000);
     
         

        } 
    }); 
  
  
    }
  }, false);
}
    $("body").on('change', 'input#ifile',function(){
    let formData = new FormData(); 
  formData.append("file", document.getElementById("ifile").files[0], document.getElementById("ifile").files[0].name);
    formData.append("upload_file", true);
    $.ajax({
      method: 'POST',
      headers: { 'Content-Type': 'multipart/form-data' },
        url: '/users/medecin/changePictureFile',
        data:    formData,
        success: function (result) { 
          showMsg(result.msg,!result.err);
          setTimeout(function(){
            window.location.reload();
                },5000);
         

        } 
    }); 
  
  });
$(function() { 

$('#sidebarCollapse').on('click', function() {
$('#sidebar, #content').toggleClass('active');
$('.alert').addClass("show");
     
});
});

const heured = document.getElementById('heured');
const heuref = document.getElementById('heuref');
const jour = document.getElementById('jour'); 
const btn = document.getElementById('btn-add-date');

btn.onclick = function() {
  if(jour.value =="") {
    showMsg("vous devez choisir le jour",false);
    return;
  }else if(heured.value ==""){
    showMsg("vous devez choisir l'heure de début",false);
return;
  }else if(heuref.value == ""){
    showMsg("vous devez choisir l'heure de fin",false);
    return;  
  }else {
    $.ajax({
        method: 'POST',
        url: '/users/medecin/addWork',
        data: {
          'work_date' : jour.value, 
          'starttime' : heured.value, 
          'endtime' : heuref.value,
          
          
        },
        success: function (result) { 
          showMsg(result.msg,!result.err);
          setTimeout(function(){
            window.location.reload();
                },5000);
        }});
  }
}

</script>
<script>
  $(function() { 

  $('#sidebarCollapse2').on('click', function() {
    
    $('#sidebar, #content').toggleClass('active');
    $('.alert').addClass("show");
    
  });
});
</script>

<script>
  function myFunction2(date) {
    console.log('here');
  document.getElementById(date).classList.toggle("show");
}

// Close the dropdown menu if the user clicks outside of it
window.onclick = function(event) {
  if (!event.target.matches('.dropbtn2')) {
    var dropdowns = document.getElementsByClassName("dropdown-content2");
    var i;
    for (i = 0; i < dropdowns.length; i++) {
      var openDropdown = dropdowns[i];
      if (openDropdown.classList.contains('show')) {
        openDropdown.classList.remove('show');
      }
    }
  }
}
</script>
<script>
  function myFunction() {
document.getElementById("myDropdown").classList.toggle("show");
}

// Close the dropdown menu if the user clicks outside of it
window.onclick = function(event) {


  
  $.ajax({
      method: 'POST',
      url: '/users/medecin/seenotifs',
      success: function (result) { 
       
  if(result.msg == 'success') {
      txt.innerHTML = 0 ; 
  }  
  
      }});

if (!event.target.matches('.dropbtn')) {
  var dropdowns = document.getElementsByClassName("dropdown-content");
  var i;
  for (i = 0; i < dropdowns.length; i++) {
    var openDropdown = dropdowns[i];
    if (openDropdown.classList.contains('show')) {
      openDropdown.classList.remove('show');
    }
  }
}
}
</script>
</html>